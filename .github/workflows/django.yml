name: Django CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
#add deployin job later
  # testing:

  #   runs-on: ubuntu-latest
  #   strategy:
  #     max-parallel: 4
  #     matrix:
  #       python-version: [3.12]

  #   steps:
  #   - uses: actions/checkout@v4
  #   - name: Set up Python ${{ matrix.python-version }}
  #     uses: actions/setup-python@v3
  #     with:
  #       python-version: ${{ matrix.python-version }}
  #   - name: Install Dependencies
  #     run: |
  #       python -m pip install --upgrade pip
  #       pip install -r requirements.txt
  #   - name: Run Tests
  #     run: |
  #       python backend/manage.py test

  deploy:
    # needs: testing
    runs-on: [self-hosted, web-server]
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: 3.12
    - name: Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Backend Migrations
      run: |
        cd backend
        python manage.py makemigrations
        python manage.py migrate
    - name: Start Django Server
      run: |
        cd backend
        python manage.py runserver 0.0.0.0:8000 &
    - name: Set up Node
      uses: actions/setup-node@v3
      with:
        node-version: '16'  # Adjust based on your project requirements
    - name: Install Frontend Dependencies
      run: |
        cd frontend
        npm install
    - name: Build Frontend
      run: |
        cd frontend
        npm run build
    - name: Start Frontend in Dev Mode
      run: |
        cd frontend
        npm run dev &
    - name: Pray üôè
      run: echo "Deployment succeeded, hopefully!"
