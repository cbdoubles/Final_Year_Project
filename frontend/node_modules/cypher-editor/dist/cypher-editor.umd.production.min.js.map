{"version":3,"file":"cypher-editor.umd.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n// 基本\nimport * as CodeMirror from 'codemirror';\nimport 'codemirror/lib/codemirror.css';\n\n// 主题\nimport 'codemirror/theme/base16-dark.css';\nimport 'codemirror/theme/xq-dark.css';\nimport 'codemirror/theme/erlang-dark.css';\nimport 'codemirror/theme/eclipse.css';\nimport 'codemirror/theme/elegant.css';\nimport 'codemirror/theme/blackboard.css';\n\n// 语言\n// 引入cypher\nimport 'codemirror/mode/cypher/cypher';\nimport 'codemirror/mode/sql/sql';\n\nimport 'codemirror/addon/dialog/dialog.css';\nimport 'codemirror/addon/search/searchcursor.js';\nimport 'codemirror/addon/dialog/dialog.js';\n// 代码折叠\nimport 'codemirror/addon/fold/foldgutter.css';\nimport 'codemirror/addon/fold/foldcode.js';\nimport 'codemirror/addon/fold/foldgutter.js';\n\nimport 'codemirror/addon/fold/brace-fold.js';\nimport 'codemirror/addon/fold/comment-fold.js';\n\n// 全屏模式\nimport 'codemirror/addon/display/fullscreen.css';\nimport 'codemirror/addon/display/fullscreen.js';\n\n// 简单滚动条\nimport 'codemirror/addon/scroll/simplescrollbars.css';\nimport 'codemirror/addon/scroll/simplescrollbars.js';\n\n\nimport 'codemirror/addon/hint/show-hint.css';\nimport 'codemirror/addon/hint/show-hint.js';\nimport 'codemirror/addon/hint/anyword-hint.js';\n\n// 自动匹配括号\nimport 'codemirror/addon/edit/matchbrackets.js';\nimport 'codemirror/addon/edit/closebrackets.js';\n\n// placeholder\nimport 'codemirror/addon/display/placeholder.js';\n\n\n\nimport { EditorConfig } from './type';\nimport './index.less';\n\n// 支持的语言类型\nconst ModeMap: {[key: string]: string} = {\n  'sql': 'text/x-mysql',\n  'cypher': 'cypher',\n};\n// 支持的主题\nconst ThemeMap: {[key: string]: string} = {\n  'base16-dark': 'base16-dark',\n  'xq-dark': 'xq-dark',\n  'erlang-dark': 'erlang-dark',\n  'eclipse': 'eclipse',\n  'blackboard': 'blackboard',\n};\n\nconst DEFAULT_LINENUMBERS = true;\nconst DEFAULT_THEME = 'base16-dark';\nconst DEFAULT_MODE = 'cypher';\nconst DEFAULT_UNDODEPTH = 20; \nconst DEFAULT_AUTOFOCUS = true; \nconst DEFAULT_WIDTH = 'auto';\nconst DEFAULT_HEIGHT ='200';\nconst DEFAULT_TABINDEX = 4;\n// 支持的属性的默认值\ninterface State {\n  codeMioorInstance: CodeMirror.EditorFromTextArea;\n  editorValue: any;\n}\n\ninterface Props {\n  editorConfig: EditorConfig; // 编辑器配置对象\n  initValue: string; // 初始值\n  getEditorValue: (value: any) => void; // 获取编辑器输入内容函数\n}\n\nclass CodeEditor extends React.Component<Props, State>{\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      codeMioorInstance: {} as CodeMirror.EditorFromTextArea,\n      editorValue: '',\n    };\n  }\n\n  componentDidMount() {\n    this.initCodeMioor();\n  }\n\n  initCodeMioor() {\n    // 获取初始化配置参数\n    const { editorConfig: {\n      lineNumbers=DEFAULT_LINENUMBERS,\n      theme=DEFAULT_THEME,\n      undoDepth=DEFAULT_UNDODEPTH,\n      tabindex=DEFAULT_TABINDEX,\n      mode=DEFAULT_MODE,\n      autofocus=DEFAULT_AUTOFOCUS,\n      width=DEFAULT_WIDTH,\n      height=DEFAULT_HEIGHT\n    } } = this.props;\n    const id = document.getElementById('transwarp-code-editor');\n    // 创建编辑器实例\n    const instance = CodeMirror.fromTextArea(id as HTMLTextAreaElement, {\n      lineNumbers,\n      undoDepth, // 最大回退次数\n      tabindex,\n      autofocus,\n      theme: ThemeMap[theme], // 主题\n      mode: ModeMap[mode], // 语言模式\n      // extraKeys: {\n      //   \"Ctrl+\": function(cm) {\n      //     cm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\"));\n      //   },\n      //   \"Esc+\": function(cm) {\n      //     if (cm.getOption(\"fullScreen\")) cm.setOption(\"fullScreen\", false);\n      //   },\n      //   \"Ctrl-Q\": function(cm){ cm.foldCode(cm.getCursor()); }\n      // },\n      showCursorWhenSelecting: true,\n      lineWiseCopyCut: true, // 复制\n      // autocorrect: true,\n      // spellcheck: true,\n      // fullScreen:true, // 全屏\n      matchBrackets: true, // 自动匹配括号\n      autoCloseBrackets: true, // 自动闭合括号\n      hintOptions: {\n        completeSingle: false // 自动补全\n      },\n      scrollbarStyle: \"simple\",\n      viewportMargin: Infinity,\n      foldGutter: true,\n      gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n    } as any);\n    instance.setSize(width, height);\n    instance.on('keypress', () => {\n      //编译器内容更改事件\n      instance.showHint();\n    });\n\n    const { initValue } = this.props;\n\n    // 设置初始值\n    instance.setValue(this.formatQuery(initValue));\n\n    // 监听改变事件\n    instance.on('change', () => {\n      // 将值传出去\n      let value = instance.getValue();\n      if (value) {\n        // 回车换行用空格代替\n        value =  value.replace(/(\\r\\n\\t|\\n|\\r\\t)/gm,\" \").trim();\n      }\n      this.props.getEditorValue(value);\n    });\n    instance.on('dblclick', () => {\n      this.updateEditorValue();\n    });\n    // 失去焦点时自动格式化代码\n    instance.on('blur', () => {\n      this.updateEditorValue();\n      \n    });\n    this.setState({\n      codeMioorInstance: instance\n    });\n  }\n\n  updateEditorValue() {\n    const { codeMioorInstance } = this.state;\n    const formatWalue = this.formatQuery(codeMioorInstance.getValue());\n    codeMioorInstance.setValue(formatWalue);\n  }\n\n  // 格式化cypher代码\n  formatQuery(query: any) {\n    // a primitive regex approach, based loosely on the Cypher style guide at: https://neo4j.com/developer/cypher-style-guide/\n\n    // \"Keywords, similar to clauses, should be styled in all capital letters and are not case-sensitive, but do not need to be placed on a separate line.\"\n    query = query.replace(/\\b(WHEN|CASE|AND|OR|XOR|DISTINCT|AS|IN|STARTS WITH|ENDS WITH|CONTAINS|NOT|SET|ORDER BY)\\b/gi, function(match: any) {\n        return ' ' + match.toUpperCase().trim() + ' '\n    });\n\n    // \"The null value and boolean literals should be written in lower case in a query.\"\n    query = query.replace(/\\b(NULL|TRUE|FALSE)\\b/gi, function(match: any) {\n        return ' ' + match.toLowerCase().trim() + ' '\n    });\n\n    // Now ensure that all 'main' Cypher keywords are on a new line\n    query = query.replace(/\\b(CASE|DETACH DELETE|DELETE|MATCH|MERGE|LIMIT|OPTIONAL MATCH|RETURN|UNWIND|UNION|WHERE|WITH|GROUP BY)\\b/gi, function(match: any) {\n        // \".replace(/^\\s+/,\"\")\" removes whitespace from the start of the line (safer than using \"trimStart()\" right now)\n        return '\\n' + match.toUpperCase().replace(/^\\s+/,\"\") + ' '\n    });\n\n    // some whitespace clean-up\n    query = query.replace(/^\\s+/gm, ''); // remove whitespace from start of lines\n\n    query = query.replace(/\\s+$/gm, ''); // remove whitespace from end of lines\n\n    // \"One space after each comma in lists and enumerations.\"\n    query = query.replace(/,([^\\s])/g, function(match: any) {\n        return ', ' + match.replace(/,/g, '');\n    });\n\n    query = query.replace(/ +/g, ' '); // replace multiple spaces with single space\n\n    // \"We can also make queries a bit easier to read by indenting ON CREATE or ON MATCH and any subqueries. Each of these blocks is indented with 2 spaces on a new line.\"\n    query = query.replace(/\\b(ON CREATE|ON MATCH)\\b/gi, function(match: any) {\n        return '\\n  ' + match.toUpperCase().replace(/^\\s+/,\"\") + ' '\n    });\n    query = query.replace(/ {([\\S\\s]*?)}/g, function(match: any) {\n        let block = match.trim().substring(1, match.trim().length - 1).trim();\n        return ' {\\n  ' + block.replace(/(\\r\\n|\\n|\\r)/gm, '\\n  ') + '\\n}';\n    });\n\n    query = query.replace(/\\n\\s*\\n/g, '\\n'); // remove multiple empty newlines\n\n    return query.trim();\n  }\n\n  render() {\n    return  <div className='container'>\n    <textarea\n      id=\"transwarp-code-editor\"\n      defaultValue={'match (n) return n limit 10'}\n      placeholder=\"请输入代码\"\n    >\n    </textarea>\n    </div>\n  }\n}\n\nexport default CodeEditor;\n"],"names":["ModeMap","ThemeMap","props","state","codeMioorInstance","editorValue","componentDidMount","initCodeMioor","this","editorConfig","lineNumbers","theme","undoDepth","tabindex","mode","autofocus","width","height","id","document","getElementById","instance","CodeMirror","showCursorWhenSelecting","lineWiseCopyCut","matchBrackets","autoCloseBrackets","hintOptions","completeSingle","scrollbarStyle","viewportMargin","Infinity","foldGutter","gutters","setSize","on","showHint","setValue","formatQuery","initValue","value","getValue","replace","trim","_this2","getEditorValue","updateEditorValue","setState","formatWalue","query","match","toUpperCase","toLowerCase","substring","length","render","React","className","defaultValue","placeholder"],"mappings":"klFAuDA,IAAMA,EAAmC,KAChC,sBACG,UAGNC,EAAoC,eACzB,wBACJ,wBACI,sBACJ,qBACG,uDAwBFC,8BACJA,UACDC,MAAQ,CACXC,kBAAmB,GACnBC,YAAa,iHAIjBC,kBAAA,gBACOC,mBAGPA,cAAA,wBAWQC,KAAKN,MATHO,iBACNC,YAAAA,oBACAC,MAAAA,aApCgB,oBAqChBC,UAAAA,aAnCoB,SAoCpBC,SAAAA,aAhCmB,QAiCnBC,KAAAA,aAtCe,eAuCfC,UAAAA,oBACAC,MAAAA,aArCgB,aAsChBC,OAAAA,aArCgB,QAuCZC,EAAKC,SAASC,eAAe,yBAE7BC,EAAWC,eAAwBJ,EAA2B,CAClER,YAAAA,EACAE,UAAAA,EACAC,SAAAA,EACAE,UAAAA,EACAJ,MAAOV,EAASU,GAChBG,KAAMd,EAAQc,GAUdS,yBAAyB,EACzBC,iBAAiB,EAIjBC,eAAe,EACfC,mBAAmB,EACnBC,YAAa,CACXC,gBAAgB,GAElBC,eAAgB,SAChBC,eAAgBC,SAChBC,YAAY,EACZC,QAAS,CAAC,yBAA0B,2BAEtCZ,EAASa,QAAQlB,EAAOC,GACxBI,EAASc,GAAG,YAAY,WAEtBd,EAASe,cAMXf,EAASgB,SAAS7B,KAAK8B,YAHD9B,KAAKN,MAAnBqC,YAMRlB,EAASc,GAAG,UAAU,eAEhBK,EAAQnB,EAASoB,WACjBD,IAEFA,EAASA,EAAME,QAAQ,qBAAqB,KAAKC,QAEnDC,EAAK1C,MAAM2C,eAAeL,MAE5BnB,EAASc,GAAG,YAAY,WACtBS,EAAKE,uBAGPzB,EAASc,GAAG,QAAQ,WAClBS,EAAKE,4BAGFC,SAAS,CACZ3C,kBAAmBiB,OAIvByB,kBAAA,eACU1C,EAAsBI,KAAKL,MAA3BC,kBACF4C,EAAcxC,KAAK8B,YAAYlC,EAAkBqC,YACvDrC,EAAkBiC,SAASW,MAI7BV,YAAA,SAAYW,UAwCVA,GALAA,GAHAA,GAHAA,GAJAA,GAHAA,GAFAA,GANAA,GALAA,GALAA,EAAQA,EAAMP,QAAQ,+FAA+F,SAASQ,SACnH,IAAMA,EAAMC,cAAcR,OAAS,QAIhCD,QAAQ,2BAA2B,SAASQ,SAC/C,IAAMA,EAAME,cAAcT,OAAS,QAIhCD,QAAQ,8GAA8G,SAASQ,SAElI,KAAOA,EAAMC,cAAcT,QAAQ,OAAO,IAAM,QAI7CA,QAAQ,SAAU,KAElBA,QAAQ,SAAU,KAGlBA,QAAQ,aAAa,SAASQ,SACjC,KAAOA,EAAMR,QAAQ,KAAM,QAGxBA,QAAQ,MAAO,MAGfA,QAAQ,8BAA8B,SAASQ,SAClD,OAASA,EAAMC,cAAcT,QAAQ,OAAO,IAAM,QAE/CA,QAAQ,kBAAkB,SAASQ,SAEtC,SADKA,EAAMP,OAAOU,UAAU,EAAGH,EAAMP,OAAOW,OAAS,GAAGX,OACvCD,QAAQ,iBAAkB,QAAU,UAGlDA,QAAQ,WAAY,OAErBC,UAGfY,OAAA,kBACUC,uBAAKC,UAAU,aACvBD,4BACEtC,GAAG,wBACHwC,aAAc,8BACdC,YAAY,eArJOH"}