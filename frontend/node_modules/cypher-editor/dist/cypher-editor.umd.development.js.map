{"version":3,"file":"cypher-editor.umd.development.js","sources":["../src/index.tsx"],"sourcesContent":["import * as React from 'react';\n// 基本\nimport * as CodeMirror from 'codemirror';\nimport 'codemirror/lib/codemirror.css';\n\n// 主题\nimport 'codemirror/theme/base16-dark.css';\nimport 'codemirror/theme/xq-dark.css';\nimport 'codemirror/theme/erlang-dark.css';\nimport 'codemirror/theme/eclipse.css';\nimport 'codemirror/theme/elegant.css';\nimport 'codemirror/theme/blackboard.css';\n\n// 语言\n// 引入cypher\nimport 'codemirror/mode/cypher/cypher';\nimport 'codemirror/mode/sql/sql';\n\nimport 'codemirror/addon/dialog/dialog.css';\nimport 'codemirror/addon/search/searchcursor.js';\nimport 'codemirror/addon/dialog/dialog.js';\n// 代码折叠\nimport 'codemirror/addon/fold/foldgutter.css';\nimport 'codemirror/addon/fold/foldcode.js';\nimport 'codemirror/addon/fold/foldgutter.js';\n\nimport 'codemirror/addon/fold/brace-fold.js';\nimport 'codemirror/addon/fold/comment-fold.js';\n\n// 全屏模式\nimport 'codemirror/addon/display/fullscreen.css';\nimport 'codemirror/addon/display/fullscreen.js';\n\n// 简单滚动条\nimport 'codemirror/addon/scroll/simplescrollbars.css';\nimport 'codemirror/addon/scroll/simplescrollbars.js';\n\n\nimport 'codemirror/addon/hint/show-hint.css';\nimport 'codemirror/addon/hint/show-hint.js';\nimport 'codemirror/addon/hint/anyword-hint.js';\n\n// 自动匹配括号\nimport 'codemirror/addon/edit/matchbrackets.js';\nimport 'codemirror/addon/edit/closebrackets.js';\n\n// placeholder\nimport 'codemirror/addon/display/placeholder.js';\n\n\n\nimport { EditorConfig } from './type';\nimport './index.less';\n\n// 支持的语言类型\nconst ModeMap: {[key: string]: string} = {\n  'sql': 'text/x-mysql',\n  'cypher': 'cypher',\n};\n// 支持的主题\nconst ThemeMap: {[key: string]: string} = {\n  'base16-dark': 'base16-dark',\n  'xq-dark': 'xq-dark',\n  'erlang-dark': 'erlang-dark',\n  'eclipse': 'eclipse',\n  'blackboard': 'blackboard',\n};\n\nconst DEFAULT_LINENUMBERS = true;\nconst DEFAULT_THEME = 'base16-dark';\nconst DEFAULT_MODE = 'cypher';\nconst DEFAULT_UNDODEPTH = 20; \nconst DEFAULT_AUTOFOCUS = true; \nconst DEFAULT_WIDTH = 'auto';\nconst DEFAULT_HEIGHT ='200';\nconst DEFAULT_TABINDEX = 4;\n// 支持的属性的默认值\ninterface State {\n  codeMioorInstance: CodeMirror.EditorFromTextArea;\n  editorValue: any;\n}\n\ninterface Props {\n  editorConfig: EditorConfig; // 编辑器配置对象\n  initValue: string; // 初始值\n  getEditorValue: (value: any) => void; // 获取编辑器输入内容函数\n}\n\nclass CodeEditor extends React.Component<Props, State>{\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      codeMioorInstance: {} as CodeMirror.EditorFromTextArea,\n      editorValue: '',\n    };\n  }\n\n  componentDidMount() {\n    this.initCodeMioor();\n  }\n\n  initCodeMioor() {\n    // 获取初始化配置参数\n    const { editorConfig: {\n      lineNumbers=DEFAULT_LINENUMBERS,\n      theme=DEFAULT_THEME,\n      undoDepth=DEFAULT_UNDODEPTH,\n      tabindex=DEFAULT_TABINDEX,\n      mode=DEFAULT_MODE,\n      autofocus=DEFAULT_AUTOFOCUS,\n      width=DEFAULT_WIDTH,\n      height=DEFAULT_HEIGHT\n    } } = this.props;\n    const id = document.getElementById('transwarp-code-editor');\n    // 创建编辑器实例\n    const instance = CodeMirror.fromTextArea(id as HTMLTextAreaElement, {\n      lineNumbers,\n      undoDepth, // 最大回退次数\n      tabindex,\n      autofocus,\n      theme: ThemeMap[theme], // 主题\n      mode: ModeMap[mode], // 语言模式\n      // extraKeys: {\n      //   \"Ctrl+\": function(cm) {\n      //     cm.setOption(\"fullScreen\", !cm.getOption(\"fullScreen\"));\n      //   },\n      //   \"Esc+\": function(cm) {\n      //     if (cm.getOption(\"fullScreen\")) cm.setOption(\"fullScreen\", false);\n      //   },\n      //   \"Ctrl-Q\": function(cm){ cm.foldCode(cm.getCursor()); }\n      // },\n      showCursorWhenSelecting: true,\n      lineWiseCopyCut: true, // 复制\n      // autocorrect: true,\n      // spellcheck: true,\n      // fullScreen:true, // 全屏\n      matchBrackets: true, // 自动匹配括号\n      autoCloseBrackets: true, // 自动闭合括号\n      hintOptions: {\n        completeSingle: false // 自动补全\n      },\n      scrollbarStyle: \"simple\",\n      viewportMargin: Infinity,\n      foldGutter: true,\n      gutters: [\"CodeMirror-linenumbers\", \"CodeMirror-foldgutter\"],\n    } as any);\n    instance.setSize(width, height);\n    instance.on('keypress', () => {\n      //编译器内容更改事件\n      instance.showHint();\n    });\n\n    const { initValue } = this.props;\n\n    // 设置初始值\n    instance.setValue(this.formatQuery(initValue));\n\n    // 监听改变事件\n    instance.on('change', () => {\n      // 将值传出去\n      let value = instance.getValue();\n      if (value) {\n        // 回车换行用空格代替\n        value =  value.replace(/(\\r\\n\\t|\\n|\\r\\t)/gm,\" \").trim();\n      }\n      this.props.getEditorValue(value);\n    });\n    instance.on('dblclick', () => {\n      this.updateEditorValue();\n    });\n    // 失去焦点时自动格式化代码\n    instance.on('blur', () => {\n      this.updateEditorValue();\n      \n    });\n    this.setState({\n      codeMioorInstance: instance\n    });\n  }\n\n  updateEditorValue() {\n    const { codeMioorInstance } = this.state;\n    const formatWalue = this.formatQuery(codeMioorInstance.getValue());\n    codeMioorInstance.setValue(formatWalue);\n  }\n\n  // 格式化cypher代码\n  formatQuery(query: any) {\n    // a primitive regex approach, based loosely on the Cypher style guide at: https://neo4j.com/developer/cypher-style-guide/\n\n    // \"Keywords, similar to clauses, should be styled in all capital letters and are not case-sensitive, but do not need to be placed on a separate line.\"\n    query = query.replace(/\\b(WHEN|CASE|AND|OR|XOR|DISTINCT|AS|IN|STARTS WITH|ENDS WITH|CONTAINS|NOT|SET|ORDER BY)\\b/gi, function(match: any) {\n        return ' ' + match.toUpperCase().trim() + ' '\n    });\n\n    // \"The null value and boolean literals should be written in lower case in a query.\"\n    query = query.replace(/\\b(NULL|TRUE|FALSE)\\b/gi, function(match: any) {\n        return ' ' + match.toLowerCase().trim() + ' '\n    });\n\n    // Now ensure that all 'main' Cypher keywords are on a new line\n    query = query.replace(/\\b(CASE|DETACH DELETE|DELETE|MATCH|MERGE|LIMIT|OPTIONAL MATCH|RETURN|UNWIND|UNION|WHERE|WITH|GROUP BY)\\b/gi, function(match: any) {\n        // \".replace(/^\\s+/,\"\")\" removes whitespace from the start of the line (safer than using \"trimStart()\" right now)\n        return '\\n' + match.toUpperCase().replace(/^\\s+/,\"\") + ' '\n    });\n\n    // some whitespace clean-up\n    query = query.replace(/^\\s+/gm, ''); // remove whitespace from start of lines\n\n    query = query.replace(/\\s+$/gm, ''); // remove whitespace from end of lines\n\n    // \"One space after each comma in lists and enumerations.\"\n    query = query.replace(/,([^\\s])/g, function(match: any) {\n        return ', ' + match.replace(/,/g, '');\n    });\n\n    query = query.replace(/ +/g, ' '); // replace multiple spaces with single space\n\n    // \"We can also make queries a bit easier to read by indenting ON CREATE or ON MATCH and any subqueries. Each of these blocks is indented with 2 spaces on a new line.\"\n    query = query.replace(/\\b(ON CREATE|ON MATCH)\\b/gi, function(match: any) {\n        return '\\n  ' + match.toUpperCase().replace(/^\\s+/,\"\") + ' '\n    });\n    query = query.replace(/ {([\\S\\s]*?)}/g, function(match: any) {\n        let block = match.trim().substring(1, match.trim().length - 1).trim();\n        return ' {\\n  ' + block.replace(/(\\r\\n|\\n|\\r)/gm, '\\n  ') + '\\n}';\n    });\n\n    query = query.replace(/\\n\\s*\\n/g, '\\n'); // remove multiple empty newlines\n\n    return query.trim();\n  }\n\n  render() {\n    return  <div className='container'>\n    <textarea\n      id=\"transwarp-code-editor\"\n      defaultValue={'match (n) return n limit 10'}\n      placeholder=\"请输入代码\"\n    >\n    </textarea>\n    </div>\n  }\n}\n\nexport default CodeEditor;\n"],"names":["ModeMap","ThemeMap","DEFAULT_LINENUMBERS","DEFAULT_THEME","DEFAULT_MODE","DEFAULT_UNDODEPTH","DEFAULT_AUTOFOCUS","DEFAULT_WIDTH","DEFAULT_HEIGHT","DEFAULT_TABINDEX","CodeEditor","props","state","codeMioorInstance","editorValue","componentDidMount","initCodeMioor","editorConfig","lineNumbers","theme","undoDepth","tabindex","mode","autofocus","width","height","id","document","getElementById","instance","CodeMirror","showCursorWhenSelecting","lineWiseCopyCut","matchBrackets","autoCloseBrackets","hintOptions","completeSingle","scrollbarStyle","viewportMargin","Infinity","foldGutter","gutters","setSize","on","showHint","initValue","setValue","formatQuery","value","getValue","replace","trim","getEditorValue","updateEditorValue","setState","formatWalue","query","match","toUpperCase","toLowerCase","block","substring","length","render","React","className","defaultValue","placeholder"],"mappings":";;;;;;;;;;;;;;;;;;;;;;EAuDA,IAAMA,OAAO,GAA4B;EACvC,SAAO,cADgC;EAEvC,YAAU;EAF6B,CAAzC;;EAKA,IAAMC,QAAQ,GAA4B;EACxC,iBAAe,aADyB;EAExC,aAAW,SAF6B;EAGxC,iBAAe,aAHyB;EAIxC,aAAW,SAJ6B;EAKxC,gBAAc;EAL0B,CAA1C;EAQA,IAAMC,mBAAmB,GAAG,IAA5B;EACA,IAAMC,aAAa,GAAG,aAAtB;EACA,IAAMC,YAAY,GAAG,QAArB;EACA,IAAMC,iBAAiB,GAAG,EAA1B;EACA,IAAMC,iBAAiB,GAAG,IAA1B;EACA,IAAMC,aAAa,GAAG,MAAtB;EACA,IAAMC,cAAc,GAAE,KAAtB;EACA,IAAMC,gBAAgB,GAAG,CAAzB;;MAaMC;;;EACJ,sBAAYC,KAAZ;;;EACE,wCAAMA,KAAN;EACA,UAAKC,KAAL,GAAa;EACXC,MAAAA,iBAAiB,EAAE,EADR;EAEXC,MAAAA,WAAW,EAAE;EAFF,KAAb;;EAID;;;;WAEDC,oBAAA;EACE,SAAKC,aAAL;EACD;;WAEDA,gBAAA;;;EACE;EACA,gCASM,KAAKL,KATX,CAAQM,YAAR;EAAA,uDACEC,WADF;EAAA,QACEA,WADF,uCACchB,mBADd;EAAA,uDAEEiB,KAFF;EAAA,QAEEA,KAFF,uCAEQhB,aAFR;EAAA,uDAGEiB,SAHF;EAAA,QAGEA,SAHF,uCAGYf,iBAHZ;EAAA,uDAIEgB,QAJF;EAAA,QAIEA,QAJF,uCAIWZ,gBAJX;EAAA,uDAKEa,IALF;EAAA,QAKEA,IALF,uCAKOlB,YALP;EAAA,uDAMEmB,SANF;EAAA,QAMEA,SANF,uCAMYjB,iBANZ;EAAA,uDAOEkB,KAPF;EAAA,QAOEA,KAPF,uCAOQjB,aAPR;EAAA,uDAQEkB,MARF;EAAA,QAQEA,MARF,uCAQSjB,cART;EAUA,QAAMkB,EAAE,GAAGC,QAAQ,CAACC,cAAT,CAAwB,uBAAxB,CAAX;;EAEA,QAAMC,QAAQ,GAAGC,uBAAA,CAAwBJ,EAAxB,EAAmD;EAClER,MAAAA,WAAW,EAAXA,WADkE;EAElEE,MAAAA,SAAS,EAATA,SAFkE;EAGlEC,MAAAA,QAAQ,EAARA,QAHkE;EAIlEE,MAAAA,SAAS,EAATA,SAJkE;EAKlEJ,MAAAA,KAAK,EAAElB,QAAQ,CAACkB,KAAD,CALmD;EAMlEG,MAAAA,IAAI,EAAEtB,OAAO,CAACsB,IAAD,CANqD;EAOlE;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACAS,MAAAA,uBAAuB,EAAE,IAhByC;EAiBlEC,MAAAA,eAAe,EAAE,IAjBiD;EAkBlE;EACA;EACA;EACAC,MAAAA,aAAa,EAAE,IArBmD;EAsBlEC,MAAAA,iBAAiB,EAAE,IAtB+C;EAuBlEC,MAAAA,WAAW,EAAE;EACXC,QAAAA,cAAc,EAAE,KADL;;EAAA,OAvBqD;EA0BlEC,MAAAA,cAAc,EAAE,QA1BkD;EA2BlEC,MAAAA,cAAc,EAAEC,QA3BkD;EA4BlEC,MAAAA,UAAU,EAAE,IA5BsD;EA6BlEC,MAAAA,OAAO,EAAE,CAAC,wBAAD,EAA2B,uBAA3B;EA7ByD,KAAnD,CAAjB;EA+BAZ,IAAAA,QAAQ,CAACa,OAAT,CAAiBlB,KAAjB,EAAwBC,MAAxB;EACAI,IAAAA,QAAQ,CAACc,EAAT,CAAY,UAAZ,EAAwB;EACtB;EACAd,MAAAA,QAAQ,CAACe,QAAT;EACD,KAHD;EAKA,QAAQC,SAAR,GAAsB,KAAKlC,KAA3B,CAAQkC,SAAR;;EAGAhB,IAAAA,QAAQ,CAACiB,QAAT,CAAkB,KAAKC,WAAL,CAAiBF,SAAjB,CAAlB;;EAGAhB,IAAAA,QAAQ,CAACc,EAAT,CAAY,QAAZ,EAAsB;EACpB;EACA,UAAIK,KAAK,GAAGnB,QAAQ,CAACoB,QAAT,EAAZ;;EACA,UAAID,KAAJ,EAAW;EACT;EACAA,QAAAA,KAAK,GAAIA,KAAK,CAACE,OAAN,CAAc,oBAAd,EAAmC,GAAnC,EAAwCC,IAAxC,EAAT;EACD;;EACD,MAAA,MAAI,CAACxC,KAAL,CAAWyC,cAAX,CAA0BJ,KAA1B;EACD,KARD;EASAnB,IAAAA,QAAQ,CAACc,EAAT,CAAY,UAAZ,EAAwB;EACtB,MAAA,MAAI,CAACU,iBAAL;EACD,KAFD;;EAIAxB,IAAAA,QAAQ,CAACc,EAAT,CAAY,MAAZ,EAAoB;EAClB,MAAA,MAAI,CAACU,iBAAL;EAED,KAHD;EAIA,SAAKC,QAAL,CAAc;EACZzC,MAAAA,iBAAiB,EAAEgB;EADP,KAAd;EAGD;;WAEDwB,oBAAA;EACE,QAAQxC,iBAAR,GAA8B,KAAKD,KAAnC,CAAQC,iBAAR;EACA,QAAM0C,WAAW,GAAG,KAAKR,WAAL,CAAiBlC,iBAAiB,CAACoC,QAAlB,EAAjB,CAApB;EACApC,IAAAA,iBAAiB,CAACiC,QAAlB,CAA2BS,WAA3B;EACD;;;WAGDR,cAAA,qBAAYS,KAAZ;EACE;EAEA;EACAA,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,6FAAd,EAA6G,UAASO,KAAT;EACjH,aAAO,MAAMA,KAAK,CAACC,WAAN,GAAoBP,IAApB,EAAN,GAAmC,GAA1C;EACH,KAFO,CAAR;;EAKAK,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,yBAAd,EAAyC,UAASO,KAAT;EAC7C,aAAO,MAAMA,KAAK,CAACE,WAAN,GAAoBR,IAApB,EAAN,GAAmC,GAA1C;EACH,KAFO,CAAR;;EAKAK,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,4GAAd,EAA4H,UAASO,KAAT;EAChI;EACA,aAAO,OAAOA,KAAK,CAACC,WAAN,GAAoBR,OAApB,CAA4B,MAA5B,EAAmC,EAAnC,CAAP,GAAgD,GAAvD;EACH,KAHO,CAAR;;EAMAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,QAAd,EAAwB,EAAxB,CAAR;;EAEAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,QAAd,EAAwB,EAAxB,CAAR;EAEA;;EACAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,WAAd,EAA2B,UAASO,KAAT;EAC/B,aAAO,OAAOA,KAAK,CAACP,OAAN,CAAc,IAAd,EAAoB,EAApB,CAAd;EACH,KAFO,CAAR;EAIAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,KAAd,EAAqB,GAArB,CAAR;EAEA;;EACAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,4BAAd,EAA4C,UAASO,KAAT;EAChD,aAAO,SAASA,KAAK,CAACC,WAAN,GAAoBR,OAApB,CAA4B,MAA5B,EAAmC,EAAnC,CAAT,GAAkD,GAAzD;EACH,KAFO,CAAR;EAGAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,gBAAd,EAAgC,UAASO,KAAT;EACpC,UAAIG,KAAK,GAAGH,KAAK,CAACN,IAAN,GAAaU,SAAb,CAAuB,CAAvB,EAA0BJ,KAAK,CAACN,IAAN,GAAaW,MAAb,GAAsB,CAAhD,EAAmDX,IAAnD,EAAZ;EACA,aAAO,WAAWS,KAAK,CAACV,OAAN,CAAc,gBAAd,EAAgC,MAAhC,CAAX,GAAqD,KAA5D;EACH,KAHO,CAAR;EAKAM,IAAAA,KAAK,GAAGA,KAAK,CAACN,OAAN,CAAc,UAAd,EAA0B,IAA1B,CAAR;;EAEA,WAAOM,KAAK,CAACL,IAAN,EAAP;EACD;;WAEDY,SAAA;EACE,WAAQC,mBAAA,MAAA;EAAKC,MAAAA,SAAS,EAAC;OAAf,EACRD,mBAAA,WAAA;EACEtC,MAAAA,EAAE,EAAC;EACHwC,MAAAA,YAAY,EAAE;EACdC,MAAAA,WAAW,EAAC;OAHd,CADQ,CAAR;EAQD;;;IAzJsBH;;;;;;;;;;;;"}